---
phase: 02-vehicle-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
autonomous: true

must_haves:
  truths:
    - 'Vehicle schema supports basic fields (brand, model, year, fuel type)'
    - 'Vehicle schema supports optional technical fields (engine capacity, power)'
    - 'Vehicle schema supports optional registration field'
    - 'Schema does not depend on non-existent lookup tables'
  artifacts:
    - path: 'prisma/schema.prisma'
      provides: 'Simplified Vehicle model with direct fields'
      contains: 'model Vehicle'
  key_links:
    - from: 'prisma/schema.prisma'
      to: 'application code'
      via: 'Prisma client generation'
      pattern: '@prisma/client'
---

<objective>
Simplify the Vehicle schema to remove dependencies on non-existent lookup tables and align with Phase 2 requirements.

Purpose: The current schema references multiple foreign keys (fuel_type_id, transmission_id, power_unit_id, type_id, mileage_in_id, currency_id) pointing to tables that don't exist. This blocks form development and API usage. We need a simplified schema with direct string/enum fields that matches the CONTEXT.md decisions for Phase 2.

Output: Updated prisma/schema.prisma with simplified Vehicle model ready for Phase 2 CRUD operations.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-vehicle-management/02-CONTEXT.md
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Simplify Vehicle schema and sync database</name>
  <files>prisma/schema.prisma</files>
  <action>
Update the Vehicle model in prisma/schema.prisma to remove foreign key dependencies and use direct fields:

**Required changes:**

1. Replace `fuel_type_id Int` with `fuel_type String @db.VarChar(50)` (values: "gasoline", "diesel", "lpg", "electric", "hybrid")
2. Replace `transmission_id Int` with `transmission String? @db.VarChar(50)` (optional, values: "manual", "automatic")
3. Replace `power_unit_id Int` with `power_unit String? @db.VarChar(10)` (optional, values: "HP", "kW")
4. Replace `type_id Int` with `vehicle_type String? @db.VarChar(50)` (optional, values: "car", "truck", "motorcycle")
5. Replace `mileage_in_id Int` with `mileage_unit String @default("km") @db.VarChar(10)` (values: "km", "miles")
6. Replace `currency_id Int` with `currency String @default("PLN") @db.VarChar(3)` (ISO currency codes)
7. Add `registration_number String? @db.VarChar(50)` (optional field for license plate)
8. Make technical fields optional: `engine_capacity Int?`, `engine_power Int?`
9. Remove `value Int` field (not in v1 requirements)

**Keep these fields unchanged:**

- id, user_id, user relation, brand_name, model_name, production_year
- mileage (Float), created_at, updated_at
- Relations: fuelings, expenses

**After schema changes:**
Run `npx prisma db push` to sync database schema without creating a migration (development workflow per AGENTS.md)

**Important:** This is a breaking change. The database will be updated to match the new schema. Existing data with old structure will need to be handled (if any exists, prompt user about data loss).
</action>
<verify>
Run `npx prisma db push` and confirm success. Run `npx prisma generate` to regenerate Prisma client. Check that TypeScript compilation succeeds with `npm run build`.
</verify>
<done>
Vehicle model uses direct string/enum fields instead of foreign key IDs. Schema synced to database. Prisma client regenerated. No TypeScript compilation errors.
</done>
</task>

</tasks>

<verification>
- [ ] prisma/schema.prisma contains simplified Vehicle model with direct fields
- [ ] No foreign key references to non-existent lookup tables
- [ ] registration_number field exists as optional string
- [ ] Technical fields (engine_capacity, engine_power) are optional
- [ ] `npx prisma db push` runs without errors
- [ ] `npx prisma generate` completes successfully
- [ ] `npm run build` succeeds without TypeScript errors
</verification>

<success_criteria>
Vehicle schema is simplified and ready for form development. No dependencies on non-existent tables. Database schema synced. Prisma client reflects new model structure.
</success_criteria>

<output>
After completion, create `.planning/phases/02-vehicle-management/02-01-SUMMARY.md`
</output>
