---
phase: 02-vehicle-management
plan: 04
type: execute
wave: 3
depends_on: ['02-03']
files_modified:
  - pages/vehicles/[id]/index.tsx
  - components/vehicles/DeleteVehicleModal.tsx
autonomous: true

must_haves:
  truths:
    - 'User can view vehicle details on dedicated page'
    - 'User can access Edit from detail page'
    - 'User can delete vehicle with confirmation modal'
    - 'Delete action requires explicit confirmation'
    - 'After delete, user is redirected to vehicle list'
  artifacts:
    - path: 'pages/vehicles/[id]/index.tsx'
      provides: 'Vehicle detail page'
      min_lines: 80
    - path: 'components/vehicles/DeleteVehicleModal.tsx'
      provides: 'Delete confirmation modal'
      min_lines: 60
  key_links:
    - from: 'pages/vehicles/[id]/index.tsx'
      to: '/api/vehicles/[id]'
      via: 'TanStack Query fetch'
      pattern: 'useQuery.*vehicle.*id'
    - from: 'components/DeleteVehicleModal.tsx'
      to: '/api/vehicles/[id]'
      via: 'DELETE mutation'
      pattern: 'method.*DELETE'
---

<objective>
Create vehicle detail page with delete functionality and confirmation modal to complete the CRUD operations.

Purpose: Users need a dedicated page to view vehicle details and access edit/delete actions. Delete requires confirmation to prevent accidental data loss per CONTEXT.md decisions.

Output: Working vehicle detail page with full information display and delete confirmation modal.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-vehicle-management/02-CONTEXT.md
@.planning/phases/02-vehicle-management/02-03-SUMMARY.md
@prisma/schema.prisma
@pages/api/vehicles/[id].ts
</context>

<tasks>

<task type="auto">
  <name>Create vehicle detail page</name>
  <files>pages/vehicles/[id]/index.tsx</files>
  <action>
Create pages/vehicles/[id]/index.tsx as the main vehicle detail page:

**Page structure:**

**Section 1: Vehicle Header**

- Large heading: "{brand_name} {model_name}"
- Subheading row with key specs (compact, gray text):
  - Production year: "2020"
  - Fuel type with icon: "â›½ Gasoline"
  - Registration: "ABC 1234" (or "No registration" if empty)
  - Engine specs if available: "2.0L, 150 HP"

**Section 2: Action Buttons**

- Primary button: "Edit Vehicle" (links to `/vehicles/[id]/edit`)
- Secondary button: "Delete Vehicle" (opens delete confirmation modal)
- Tertiary/link: "Back to Vehicles" (navigates to `/vehicles`)

**Section 3: Vehicle Information Cards**
Display information in cards/sections:

- **Basic Information Card:**
  - Brand, Model, Year, Fuel Type, Registration
- **Technical Specifications Card** (only show if data exists):
  - Engine Capacity, Power, Power Unit, Transmission
- **Metadata Card:**
  - Current mileage, Mileage unit
  - Created date, Last updated date

**Section 4: Placeholder for Future Features**

- Empty section with text: "Fueling records and statistics will appear here in Phase 3 and 4"
- Disabled button: "Add Fueling" with tooltip "Available in Phase 3"
- Provides visual continuity for CONTEXT.md decision

**Implementation:**

- Use TanStack Query to fetch vehicle: `useQuery({ queryKey: ['vehicle', id], queryFn: ... })`
- Fetch from `/api/vehicles/[id]` (GET endpoint exists)
- Use getServerSideProps to extract id from route params
- Loading state: `<Loading />` component
- Error state: `<FetchDataErrorAlert />` component
- Use Chakra UI components: Box, Heading, Button, ButtonGroup, Card, Text, Badge
- Responsive layout (stack on mobile, side-by-side on desktop)
- Import and use DeleteVehicleModal component with isOpen/onClose state

**Do NOT:**

- Implement fueling or statistics features (Phase 3 & 4)
- Add photo upload (deferred to post-v1)
- Add overflow menu or dropdown actions
  </action>
  <verify>
  Visit `/vehicles/[id]` for an existing vehicle. Verify all vehicle information displays correctly. Check that Edit button navigates to edit page. Click Delete button and verify modal opens (modal content tested in next task).
  </verify>
  <done>
  Vehicle detail page displays all vehicle information in organized sections with Edit and Delete actions accessible.
  </done>
  </task>

<task type="auto">
  <name>Create delete confirmation modal</name>
  <files>components/vehicles/DeleteVehicleModal.tsx</files>
  <action>
Create components/vehicles/DeleteVehicleModal.tsx as a reusable delete confirmation modal:

**Modal structure (Chakra UI Dialog/Modal):**

- **Title:** "Delete Vehicle?"
- **Body text:** "Are you sure you want to delete **{brand_name} {model_name} ({production_year})**? This vehicle and all its fueling records will be permanently deleted. This action cannot be undone."
- **Buttons:**
  - Cancel (secondary, closes modal): "Cancel"
  - Delete (destructive/red, triggers delete): "Delete Vehicle"
- **Behavior:**
  - ESC key closes modal (default Chakra behavior)
  - Click outside closes modal (default Chakra behavior)
  - Cancel button closes without action
  - Delete button triggers mutation and closes modal

**Props interface:**

```typescript
type DeleteVehicleModalProps = {
	isOpen: boolean;
	onClose: () => void;
	vehicle: {
		id: number;
		brand_name: string;
		model_name: string;
		production_year: number;
	};
	onDeleteSuccess: () => void; // callback after successful delete
};
```

**Implementation:**

- Use Chakra UI Dialog (v3) or Modal components
- Use TanStack Query useMutation for DELETE request:
  ```typescript
  const deleteMutation = useMutation({
  	mutationFn: async () => {
  		const resp = await fetch(`/api/vehicles/${vehicle.id}`, {
  			method: 'DELETE',
  		});
  		if (!resp.ok) throw new Error('Delete failed');
  		return resp.json();
  	},
  	onSuccess: () => {
  		toaster.create({ type: 'success', title: 'Vehicle deleted' });
  		onDeleteSuccess(); // trigger parent callback (e.g., navigate to /vehicles)
  	},
  	onError: () => {
  		toaster.create({ type: 'error', title: 'Failed to delete vehicle' });
  	},
  });
  ```
- Show loading spinner on Delete button during mutation: `isLoading={deleteMutation.isPending}`
- Destructive button styling: colorScheme="red"

**Do NOT:**

- Implement soft delete UI (soft delete in API is fine, but no restore feature in v1)
- Add "Delete anyway" for vehicles with fueling records (cascade delete is fine)
  </action>
  <verify>
  Open delete modal from vehicle detail page. Check that vehicle name is displayed correctly. Click Cancel and verify modal closes without action. Click Delete and verify API call is made (check network tab). Verify success toast appears and navigation occurs.
  </verify>
  <done>
  Delete confirmation modal warns user clearly, requires explicit confirmation, and triggers DELETE API call with proper success/error handling.
  </done>
  </task>

</tasks>

<verification>
- [ ] Vehicle detail page loads at `/vehicles/[id]`
- [ ] Page displays all vehicle information (basic, technical, metadata)
- [ ] Edit button navigates to `/vehicles/[id]/edit`
- [ ] Delete button opens confirmation modal
- [ ] Modal displays vehicle name and warning message
- [ ] Modal Cancel button closes without action
- [ ] Modal Delete button triggers DELETE API call
- [ ] After successful delete, user redirected to `/vehicles`
- [ ] Success toast appears after delete
- [ ] Error toast appears if delete fails
</verification>

<success_criteria>
Vehicle detail page provides complete view of vehicle information. Delete functionality requires explicit confirmation and handles success/error states properly. All CRUD operations (VEHI-03, VEHI-04, VEHI-05, VEHI-06) are complete.
</success_criteria>

<output>
After completion, create `.planning/phases/02-vehicle-management/02-04-SUMMARY.md`
</output>
