---
phase: 04-statistics-&-charts
plan: 02
type: execute
wave: 2
depends_on:
  - 04-01
files_modified:
  - package.json
  - package-lock.json
  - hooks/useVehicleStatistics.ts
  - hooks/index.ts
autonomous: true

must_haves:
  truths:
    - 'User can load statistics data for a selected vehicle'
    - 'User can render statistics charts in the UI without chart-library errors'
  artifacts:
    - path: 'package.json'
      provides: 'Recharts dependency'
      contains: 'recharts'
    - path: 'hooks/useVehicleStatistics.ts'
      provides: 'Statistics data hook'
      exports: ['useVehicleStatistics']
      min_lines: 30
    - path: 'hooks/index.ts'
      provides: 'Barrel export for statistics hook'
      contains: 'useVehicleStatistics'
  key_links:
    - from: 'hooks/useVehicleStatistics.ts'
      to: '/api/vehicles/[id]/statistics'
      via: 'fetch in queryFn'
      pattern: 'fetch.*statistics'
    - from: 'hooks/index.ts'
      to: 'hooks/useVehicleStatistics.ts'
      via: 'export statement'
      pattern: 'useVehicleStatistics'
---

<objective>
Install Recharts and add a typed data hook for vehicle statistics.

Purpose: The charts rely on Recharts, and the UI needs a consistent data hook that fetches statistics from the API with proper caching and error handling.

Output: Recharts dependency and a `useVehicleStatistics` hook exported through the hooks barrel.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-fueling-records/03-02-SUMMARY.md
@hooks/useFuelings.ts
@types/statistics_types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts</name>
  <files>package.json, package-lock.json</files>
  <action>
    Install Recharts as a production dependency:
    - Run `npm install recharts`.
    - Ensure `package.json` and `package-lock.json` are updated.
  </action>
  <verify>npm ls recharts</verify>
  <done>Recharts is listed in package.json and resolves in npm ls output</done>
</task>

<task type="auto">
  <name>Task 2: Create useVehicleStatistics hook</name>
  <files>hooks/useVehicleStatistics.ts, hooks/index.ts</files>
  <action>
    Create a TanStack Query hook for the statistics API.

    **hooks/useVehicleStatistics.ts**
    - Export `useVehicleStatistics(vehicleId?: number)`.
    - Use `useQuery` with queryKey `['vehicleStatistics', vehicleId]`.
    - Fetch `/api/vehicles/${vehicleId}/statistics` and throw on non-OK response.
    - Return typed data (`VehicleStatisticsResponse`) from `types/statistics_types`.
    - Use `enabled: !!vehicleId` to avoid fetching without a valid id.

    **hooks/index.ts**
    - Add `export { useVehicleStatistics } from './useVehicleStatistics';`.

  </action>
  <verify>ls -la hooks/useVehicleStatistics.ts</verify>
  <done>Statistics hook fetches the API with a stable query key and typed response</done>
</task>

</tasks>

<verification>
1. `npm ls recharts` succeeds.
2. useVehicleStatistics compiles and returns typed data when vehicleId is provided.
</verification>

<success_criteria>

- Recharts dependency added to the project
- useVehicleStatistics hook exists and is exported in hooks/index.ts
  </success_criteria>

<output>
After completion, create `.planning/phases/04-statistics-&-charts/04-02-SUMMARY.md`
</output>
