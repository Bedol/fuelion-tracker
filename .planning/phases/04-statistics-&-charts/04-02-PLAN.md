---
phase: 04-statistics-&-charts
plan: 02
type: execute
wave: 2
depends_on: ['04-01']
files_modified:
  - package.json
  - package-lock.json
  - hooks/useVehicleStatistics.ts
  - hooks/index.ts
  - types/index.ts
  - components/statistics/ConsumptionChart.tsx
  - components/statistics/MonthlyCostChart.tsx
  - components/statistics/SummaryCards.tsx
  - components/statistics/ChartsSection.tsx
  - components/statistics/NotEnoughDataCard.tsx
autonomous: true

must_haves:
  truths:
    - 'Recharts is installed and ready for chart rendering'
    - 'Statistics hook fetches data from the vehicle statistics API'
    - 'Charts render with a fixed-height container or show empty states'
  artifacts:
    - path: 'hooks/useVehicleStatistics.ts'
      provides: 'TanStack Query hook for vehicle stats'
      exports: ['useVehicleStatistics']
    - path: 'components/statistics/ConsumptionChart.tsx'
      provides: 'Line chart for L/100km consumption'
    - path: 'components/statistics/MonthlyCostChart.tsx'
      provides: 'Bar chart for monthly fuel costs'
  key_links:
    - from: 'hooks/useVehicleStatistics.ts'
      to: '/api/vehicles/[id]/statistics'
      via: 'fetch call'
      pattern: 'statistics'
    - from: 'components/statistics/ChartsSection.tsx'
      to: 'ConsumptionChart/MonthlyCostChart'
      via: 'component composition'
      pattern: 'ConsumptionChart'
---

<objective>
Install Recharts and build reusable statistics components and hooks for the UI.

Purpose: Provide chart-ready UI building blocks and a single data hook so the statistics page can render without custom wiring.
Output: Recharts dependency, statistics hook, and chart/summary components.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-statistics-&-charts/04-RESEARCH.md
@hooks/useFuelings.ts
@components/fueling/FuelingList.tsx
@components/statistics/ChartsSection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts dependency</name>
  <files>package.json, package-lock.json</files>
  <action>
    Install Recharts for chart rendering:
    - Run `npm install recharts`
    - Confirm `recharts` appears in package.json dependencies

    Keep the dependency list otherwise unchanged.

  </action>
  <verify>npm list recharts</verify>
  <done>Recharts is listed in dependencies and installed in node_modules</done>
</task>

<task type="auto">
  <name>Task 2: Create statistics hook and UI components</name>
  <files>hooks/useVehicleStatistics.ts, hooks/index.ts, types/index.ts, components/statistics/ConsumptionChart.tsx, components/statistics/MonthlyCostChart.tsx, components/statistics/SummaryCards.tsx, components/statistics/ChartsSection.tsx, components/statistics/NotEnoughDataCard.tsx</files>
  <action>
    Implement the data hook and chart components for statistics.

    1. Hook: `hooks/useVehicleStatistics.ts`
       - Use `useQuery` with key `['vehicle-statistics', vehicleId]`.
       - Fetch `/api/vehicles/${vehicleId}/statistics` and throw on non-OK.
       - Type the response as `VehicleStatisticsResponse`.
       - Export from `hooks/index.ts`.

    2. Types export: add `statistics_types` exports in `types/index.ts`.

    3. UI components:
       - `NotEnoughDataCard.tsx`: Chakra Card that shows emoji + heading + description; accepts title/description props.
       - `SummaryCards.tsx`: render 3 cards (total spent, average consumption, total distance) using Chakra `CardRoot`/`CardBody` and `SimpleGrid`.
         - Format currency via `new Intl.NumberFormat('pl-PL', { style: 'currency', currency })`.
         - Show `â€”` and helper text when `averageConsumption` is null.
       - `ConsumptionChart.tsx`: Recharts `LineChart` within `ResponsiveContainer`.
         - Fixed height container (e.g., `h-64`).
         - X axis uses `date` labels (preformatted in API or format in component).
         - If `hasData` is false or `data.length === 0`, show `NotEnoughDataCard`.
       - `MonthlyCostChart.tsx`: Recharts `BarChart` with fixed height container.
         - Use `label` for X-axis and `totalCost` for Y.
         - Empty state uses `NotEnoughDataCard`.
       - Update `ChartsSection.tsx` to compose `ConsumptionChart` and `MonthlyCostChart` in a stacked layout with headings.

    Use Chakra UI for layout and keep styles consistent with existing cards. Avoid hardcoded colors that clash with Chakra defaults; use `colorPalette='blue'` when needed.

  </action>
  <verify>npm run lint -- --fix</verify>
  <done>Statistics hook and chart components render with fixed heights and show empty states when data is insufficient</done>
</task>

</tasks>

<verification>
After completion:
1. Confirm `useVehicleStatistics` returns typed data without TypeScript errors
2. Verify chart components render with `ResponsiveContainer` and non-zero height
3. Verify NotEnoughDataCard appears when data arrays are empty
</verification>

<success_criteria>

- Recharts is installed and available
- Statistics components can render data or empty states without crashing
- Hook exposes a single, reusable query for the statistics page
  </success_criteria>

<output>
After completion, create `.planning/phases/04-statistics-&-charts/04-02-SUMMARY.md`
</output>
