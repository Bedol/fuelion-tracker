---
phase: 04-statistics-&-charts
plan: 04
type: execute
wave: 4
depends_on:
  - 04-02
  - 04-03
files_modified:
  - pages/vehicles/[id]/statistics.tsx
autonomous: true

must_haves:
  truths:
    - 'Statistics page loads vehicle data and statistics data with clear loading/error states'
    - 'Summary numbers and charts render for the selected vehicle'
    - 'Not enough data message appears when consumption intervals are missing'
  artifacts:
    - path: 'pages/vehicles/[id]/statistics.tsx'
      provides: 'Vehicle statistics page'
      exports: ['default']
      min_lines: 140
  key_links:
    - from: 'pages/vehicles/[id]/statistics.tsx'
      to: 'hooks/useVehicleStatistics.ts'
      via: 'useVehicleStatistics hook'
      pattern: 'useVehicleStatistics'
    - from: 'pages/vehicles/[id]/statistics.tsx'
      to: 'components/statistics/ChartsSection.tsx'
      via: 'component render'
      pattern: 'ChartsSection'
---

<objective>
Wire the statistics page to the new data hook and UI components.

Purpose: This plan connects the API and UI to provide a complete statistics view per vehicle, including summary numbers, charts, and meaningful empty states.

Output: Updated `pages/vehicles/[id]/statistics.tsx` rendering statistics data in the app's layout patterns.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@pages/vehicles/[id]/statistics.tsx
@pages/vehicles/[id]/fuelings/index.tsx
@components/statistics/index.ts
@hooks/useVehicleStatistics.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rebuild statistics page with data hook and components</name>
  <files>pages/vehicles/[id]/statistics.tsx</files>
  <action>
    Replace the placeholder statistics page with the new data-driven layout.

    **Structure & data fetching:**
    - Use `useSession({ required: true })` for auth.
    - Read `id` from `useRouter()` and derive `vehicleId` number.
    - Fetch vehicle data with `useQuery` (match pattern from fuelings list page).
    - Fetch stats with `useVehicleStatistics(vehicleId)`.

    **Layout:**
    - Use Chakra components (`Box`, `Heading`, `Text`, `Stack`, `Button`).
    - Header with vehicle name and mileage.
    - Action buttons: "Add Fueling" and "Back to Vehicle".
    - Render `StatisticsSummary` with `summary` and `currency`.
    - Render `ChartsSection` with `consumption`, `monthlyCosts`, `currency`,
      `hasConsumptionData`, and `hasCostData`.

    **Loading & error states:**
    - If session is loading or vehicle query pending: render `<Loading />`.
    - If vehicle query error or no vehicle: render `<FetchDataErrorAlert />`.
    - If stats query is error: render `<FetchDataErrorAlert />` beneath header.

    **Data assumptions:**
    - Stats response aligns with `VehicleStatisticsResponse`.
    - Summary values may be null when not enough data; components handle display.

  </action>
  <verify>ls -la pages/vehicles/[id]/statistics.tsx</verify>
  <done>Statistics page renders summary and charts using the statistics hook and components</done>
</task>

</tasks>

<verification>
1. Page loads with proper loading and error states.
2. Summary and charts render when stats data is present.
3. Empty-state messaging appears for missing consumption intervals.
</verification>

<success_criteria>

- statistics page shows vehicle header, summary cards, and charts
- statistics page uses useVehicleStatistics hook and handles query errors gracefully
- navigation buttons work for adding fueling and returning to vehicle detail
  </success_criteria>

<output>
After completion, create `.planning/phases/04-statistics-&-charts/04-04-SUMMARY.md`
</output>
