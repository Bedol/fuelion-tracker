---
phase: 04-statistics-&-charts
plan: 03
type: execute
wave: 3
depends_on:
  - 04-02
files_modified:
  - components/statistics/StatisticsSummary.tsx
  - components/statistics/StatisticsEmptyState.tsx
  - components/statistics/ConsumptionChart.tsx
  - components/statistics/MonthlyCostChart.tsx
  - components/statistics/ChartsSection.tsx
  - components/statistics/index.ts
autonomous: true

must_haves:
  truths:
    - 'Summary cards render total spent, average consumption, and total distance'
    - 'Consumption chart renders straight-line points when data exists'
    - 'Monthly cost chart renders bar series with tooltips only'
    - 'Empty state appears when data is insufficient'
  artifacts:
    - path: 'components/statistics/StatisticsSummary.tsx'
      provides: 'Summary cards UI'
      exports: ['default']
      min_lines: 40
    - path: 'components/statistics/StatisticsEmptyState.tsx'
      provides: 'Empty state messaging for missing statistics data'
      exports: ['default']
      min_lines: 30
    - path: 'components/statistics/ConsumptionChart.tsx'
      provides: 'Consumption line chart'
      exports: ['default']
      min_lines: 60
    - path: 'components/statistics/MonthlyCostChart.tsx'
      provides: 'Monthly cost bar chart'
      exports: ['default']
      min_lines: 60
    - path: 'components/statistics/ChartsSection.tsx'
      provides: 'Charts layout and empty-state handling'
      exports: ['default']
      min_lines: 60
  key_links:
    - from: 'components/statistics/ConsumptionChart.tsx'
      to: 'Recharts ResponsiveContainer'
      via: 'chart wrapper with fixed height'
      pattern: 'ResponsiveContainer'
    - from: 'components/statistics/ChartsSection.tsx'
      to: 'components/statistics/StatisticsEmptyState.tsx'
      via: 'empty state render'
      pattern: 'StatisticsEmptyState'
    - from: 'components/statistics/ChartsSection.tsx'
      to: 'ConsumptionChart, MonthlyCostChart'
      via: 'component composition'
      pattern: 'ConsumptionChart|MonthlyCostChart'
---

<objective>
Create reusable statistics UI components for summary and charts.

Purpose: Provide a clean, consistent UI layer that renders summary totals, charts, and empty states in a way that aligns with the phase decisions.

Output: Summary cards, two chart components, a charts section wrapper, and barrel exports.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-statistics-&-charts/04-CONTEXT.md
@.planning/phases/04-statistics-&-charts/04-RESEARCH.md
@components/statistics/ChartsSection.tsx
@components/fueling/FuelingList.tsx
@types/statistics_types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build summary and empty state components</name>
  <files>components/statistics/StatisticsSummary.tsx, components/statistics/StatisticsEmptyState.tsx</files>
  <action>
    Create presentational components for summary numbers and missing data.

    **StatisticsSummary.tsx**
    - Props: `summary`, `currency`.
    - Render three cards: Total Spent, Average Consumption, Total Distance.
    - Use Chakra v3 `CardRoot`, `CardBody`, `Heading`, `Text`, and `SimpleGrid` or `Stack`.
    - Format currency with `Intl.NumberFormat('pl-PL', { style: 'currency', currency })`.
    - If `averageConsumption` or `totalDistance` is null, show `--` and a helper label.

    **StatisticsEmptyState.tsx**
    - Props: `title`, `description`, optional `icon`.
    - Use the established empty-state tone (emoji + heading + short description).

  </action>
  <verify>ls -la components/statistics/StatisticsSummary.tsx</verify>
  <done>Summary cards and empty state components exist with Chakra v3 layout</done>
</task>

<task type="auto">
  <name>Task 2: Build consumption and cost chart components</name>
  <files>components/statistics/ConsumptionChart.tsx, components/statistics/MonthlyCostChart.tsx</files>
  <action>
    Create two Recharts-based components with fixed-height containers.

    **ConsumptionChart.tsx**
    - Props: `data` (ConsumptionPoint[]), `isEmpty`.
    - Render a `LineChart` with straight segments: `type='linear'` and visible dots.
    - X-axis labels: month/year (already formatted in data).
    - Y-axis auto-scales (no fixed zero baseline).
    - Tooltip displays value with `L/100km` suffix.
    - Wrap with `ResponsiveContainer` inside a parent with explicit height (e.g., `h-64`).

    **MonthlyCostChart.tsx**
    - Props: `data` (MonthlyCostPoint[]), `currency`.
    - Render a `BarChart` with chronological data (oldest to newest).
    - Tooltip only (no on-bar labels).
    - Wrap with `ResponsiveContainer` and fixed height.

  </action>
  <verify>ls -la components/statistics/ConsumptionChart.tsx</verify>
  <done>Line and bar charts render via Recharts with fixed-height containers</done>
</task>

<task type="auto">
  <name>Task 3: Compose charts section and add exports</name>
  <files>components/statistics/ChartsSection.tsx, components/statistics/index.ts</files>
  <action>
    Update the charts section to compose the new components and expose barrel exports.

    **ChartsSection.tsx**
    - Props: `consumption`, `monthlyCosts`, `currency`, `hasConsumptionData`, `hasCostData`.
    - Render `ConsumptionChart` and `MonthlyCostChart` in a stacked layout.
    - If `hasConsumptionData` is false, show `StatisticsEmptyState` in place of the line chart.
    - If `hasCostData` is false, show a `StatisticsEmptyState` for the cost chart.
    - Use Chakra v3 cards for section layout (match other pages).

    **index.ts**
    - Export `StatisticsSummary`, `ChartsSection`, `ConsumptionChart`, `MonthlyCostChart`, `StatisticsEmptyState`.

  </action>
  <verify>ls -la components/statistics/index.ts</verify>
  <done>ChartsSection composes the chart components and exports are available</done>
</task>

</tasks>

<verification>
1. Charts render with fixed height (ResponsiveContainer has a sized parent).
2. Straight-line consumption chart and tooltip behavior match phase decisions.
3. Empty states appear when data arrays are empty.
</verification>

<success_criteria>

- Summary cards and charts are available as reusable components
- ChartsSection handles empty-state rendering for missing data
- Recharts components are wired with correct axes and tooltips
  </success_criteria>

<output>
After completion, create `.planning/phases/04-statistics-&-charts/04-03-SUMMARY.md`
</output>
