---
phase: 04-statistics-&-charts
plan: 03
type: execute
wave: 3
depends_on: ['04-02']
files_modified:
  - pages/vehicles/[id]/statistics.tsx
autonomous: true

must_haves:
  truths:
    - 'Vehicle statistics page shows summary, consumption chart, and monthly cost chart'
    - 'Page displays meaningful empty states when data is insufficient'
    - 'User can navigate to fuelings from the statistics page'
  artifacts:
    - path: 'pages/vehicles/[id]/statistics.tsx'
      provides: 'Statistics page wired to vehicle stats API'
  key_links:
    - from: 'pages/vehicles/[id]/statistics.tsx'
      to: 'hooks/useVehicleStatistics.ts'
      via: 'useVehicleStatistics'
      pattern: 'useVehicleStatistics'
    - from: 'pages/vehicles/[id]/statistics.tsx'
      to: 'components/statistics/ChartsSection.tsx'
      via: 'component render'
      pattern: 'ChartsSection'
---

<objective>
Wire the statistics page to the new data hook and chart components.

Purpose: Deliver the Phase 4 user-facing page with charts, summary, and meaningful empty states.
Output: Updated statistics page rendering real data for the selected vehicle.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@pages/vehicles/[id]/statistics.tsx
@components/statistics/ChartsSection.tsx
@components/statistics/SummaryCards.tsx
@hooks/useVehicleStatistics.ts
@components/Loading.tsx
@components/errors/FetchDataErrorAlert.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace statistics page placeholder with real data</name>
  <files>pages/vehicles/[id]/statistics.tsx</files>
  <action>
    Update the statistics page to use `useVehicleStatistics` and render the new UI components.

    Requirements:
    - Keep `getServerSideProps` for `vehicleId` (as string) and pass it into the hook.
    - Use `Loading` while the query is pending and `FetchDataErrorAlert` on errors.
    - Page layout:
      1. Header with vehicle name and fuel type (from stats response vehicle object).
      2. Summary section using `SummaryCards` (pass summary + currency).
      3. Charts section using `ChartsSection` (pass consumptionSeries, monthlyCosts, and flags).
      4. Action buttons: "Add Fueling" and "View Fuelings" linking to `/vehicles/${id}/fuelings/new` and `/vehicles/${id}/fuelings`.

    Keep Chakra UI for layout (Box, Stack, Heading, ButtonGroup) and match the visual hierarchy used on the vehicle detail page. Do not reintroduce the placeholder vehicle detail section in this page.

  </action>
  <verify>npm run lint -- --fix</verify>
  <done>Statistics page renders summary cards and charts using real API data</done>
</task>

</tasks>

<verification>
After completion:
1. Visit `/vehicles/{id}/statistics` and confirm summary + charts render
2. Validate empty states show when data is insufficient (no full-tank intervals)
3. Ensure action buttons navigate correctly to fueling pages
</verification>

<success_criteria>

- Statistics page renders with data, loading, and error states
- Charts and summary update based on API response
- Empty states appear instead of incorrect calculations
  </success_criteria>

<output>
After completion, create `.planning/phases/04-statistics-&-charts/04-03-SUMMARY.md`
</output>
