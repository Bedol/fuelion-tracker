---
phase: 05-dashboard
plan: 02
type: execute
wave: 2
depends_on: [05-01]
files_modified:
  - hooks/useDashboardData.ts
  - hooks/index.ts
  - components/dashboard/VehicleSummaryCard.tsx
  - components/dashboard/RecentActivityList.tsx
autonomous: true

must_haves:
  truths:
    - 'Dashboard UI components can render vehicle summaries and recent activity from typed data'
    - 'Quick add and view actions are available per vehicle without making cards clickable'
  artifacts:
    - path: 'hooks/useDashboardData.ts'
      provides: 'React Query hook for dashboard data'
    - path: 'components/dashboard/VehicleSummaryCard.tsx'
      provides: 'Per-vehicle summary card with actions'
    - path: 'components/dashboard/RecentActivityList.tsx'
      provides: 'Compact recent activity list UI'
  key_links:
    - from: 'hooks/useDashboardData.ts'
      to: '/api/dashboard'
      via: 'fetch in queryFn'
      pattern: 'fetch.*api/dashboard'
    - from: 'components/dashboard/VehicleSummaryCard.tsx'
      to: 'DashboardVehicleSummary'
      via: 'props type'
      pattern: 'DashboardVehicleSummary'
---

<objective>
Create the dashboard data hook and reusable UI components.

Purpose: Provide typed, composable building blocks for the dashboard page.
Output: React Query hook plus vehicle summary and activity list components.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@types/dashboard_types.ts
@hooks/useVehicleStatistics.ts
@components/statistics/StatisticsSummary.tsx
@components/statistics/ChartsSection.tsx
@pages/vehicles/[id]/statistics.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add dashboard data hook</name>
  <files>hooks/useDashboardData.ts, hooks/index.ts</files>
  <action>
Create `hooks/useDashboardData.ts` using React Query v5 object syntax:
- `queryKey: ['dashboard']`
- `queryFn` fetches `/api/dashboard` and throws on non-OK responses
- returns typed `DashboardResponse`
- add a reasonable `staleTime` (e.g., 1-5 minutes) to reduce refetch noise

Export the hook from `hooks/index.ts`.
</action>
<verify>Run `npm run lint` after completing Task 3.</verify>
<done>`useDashboardData` returns typed data from `/api/dashboard` and is exported via `hooks/index.ts`.</done>
</task>

<task type="auto">
  <name>Task 2: Build vehicle summary card component</name>
  <files>components/dashboard/VehicleSummaryCard.tsx</files>
  <action>
Create `VehicleSummaryCard` that accepts `DashboardVehicleSummary` and renders:
- vehicle identity: brand/model + registration number (displayed as secondary text)
- fuel type as text label (no emoji)
- stats: total spent (currency formatted), average consumption (1 decimal, `L/100km`), total distance (`km`), last fueling date (formatted)
- action buttons: `View` (link to `/vehicles/[id]`) and `Quick add` (link to `/vehicles/[id]/fuelings/new`)

Use Chakra `CardRoot`, `CardBody`, `Heading`, `Text`, and `SimpleGrid` or `Stat` for layout, keeping spacing airy. Do not make the card itself clickable; use explicit buttons.
</action>
<verify>Run `npm run lint` after completing Task 3.</verify>
<done>Vehicle summary cards render identity, stats, and actions without using card-click navigation.</done>
</task>

<task type="auto">
  <name>Task 3: Build recent activity list component</name>
  <files>components/dashboard/RecentActivityList.tsx</files>
  <action>
Create `RecentActivityList` that accepts `DashboardActivityItem[]` and renders:
- a compact list of up to 8 rows
- each row shows vehicle label, date, total price, liters, and odometer in a single line
- rows are clickable links to `/vehicles/[vehicleId]`
- a small empty state when there is no activity

Use Chakra layout primitives (`Stack`, `Box`, `Text`, `Divider`) to keep rows single-line and compact. Format dates using `date-fns` tokens (`dd MMM yyyy`).
</action>
<verify>`npm run lint`</verify>
<done>Recent activity list renders compact, clickable rows and handles empty state gracefully.</done>
</task>

</tasks>

<verification>
- `npm run lint`
</verification>

<success_criteria>

- `useDashboardData` is available and used by the dashboard page in the next plan.
- Vehicle summary cards and activity list components are reusable and match the layout decisions.
  </success_criteria>

<output>
After completion, create `.planning/phases/05-dashboard/05-02-SUMMARY.md`
</output>
