---
phase: 03-fueling-records
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - types/fueling_types.ts
autonomous: true

must_haves:
  truths:
    - "react-intersection-observer and date-fns are installed in node_modules"
    - "Fueling type definitions exist and match Prisma schema"
    - "FuelingFormValues type includes all form fields with proper types"
    - "FuelingsList can be grouped by month with type safety"
  artifacts:
    - path: "types/fueling_types.ts"
      provides: "Type definitions for fueling records"
      exports: ["FuelingData", "FuelingFormValues", "GroupedFuelings"]
      min_lines: 50
    - path: "package.json"
      provides: "Updated dependencies"
      contains: "react-intersection-observer", "date-fns"
  key_links:
    - from: "FuelingFormValues"
      to: "FuelingData (Prisma)"
      via: "type mapping"
      pattern: "export type FuelingFormValues"
---

<objective>
Install required dependencies and create type definitions for fueling records feature.

Purpose: This plan establishes the foundation for Phase 3 by adding the necessary npm packages for infinite scroll and date handling, and creating TypeScript types that will be used across all subsequent fueling functionality.

Output: Updated package.json with new dependencies, types/fueling_types.ts with complete type definitions.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/03-fueling-records/03-CONTEXT.md
@.planning/phases/03-fueling-records/03-RESEARCH.md
@types/vehicle_types.ts

**Prior decisions to follow:**

- Form field order: Price → Liters → Odometer (from 03-CONTEXT.md)
- Use Formik with on-blur validation (from 03-RESEARCH.md)
- Price-per-liter: 3 decimal places for calculation (from 03-RESEARCH.md)
- Date handling with date-fns (from 03-RESEARCH.md)

**Database schema reference (Fueling model):**

```prisma
model Fueling {
  id                     Int       @id @default(autoincrement())
  quantity               Float     @default(0.0)
  cost                   Float     @default(0.0)
  cost_per_unit          Float     @default(0.0)
  air_conditioning       Boolean   @default(false)
  air_conditioning_value Int       @default(100)
  country                String?   @db.VarChar(2)
  region                 String?   @db.VarChar(255)
  station                String?   @db.VarChar(255)
  currency_id            Int
  date                   DateTime? @db.Date
  distance_traveled      Float     @default(0.0)
  mileage                Float     @default(0.0)
  fuel_type_id           Int
  full_tank              Boolean   @default(true)
  vehicle_id             Int
}
```

**Note:** For Phase 3, we focus on core fields: cost, quantity, cost_per_unit, date, mileage, full_tank, fuel_type_id (or fuel_type string), vehicle_id. Other fields are optional for v1.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies (react-intersection-observer, date-fns)</name>
  <files>package.json</files>
  <action>
    Install the two additional dependencies needed for Phase 3:
    1. `react-intersection-observer@^9.x` - for infinite scroll trigger
    2. `date-fns@^3.x` - for date formatting and manipulation

    Run: `npm install react-intersection-observer date-fns`

    Verify the installations by checking package.json contains both packages in dependencies.

    **Why these versions:** Research.md specifies ^9.x for react-intersection-observer and ^3.x for date-fns. These are stable, widely-used versions compatible with React 19 and Next.js 16.

  </action>
  <verify>npm list react-intersection-observer date-fns</verify>
  <done>Both packages are listed in package.json dependencies section and installed in node_modules</done>
</task>

<task type="auto">
  <name>Task 2: Create fueling type definitions</name>
  <files>types/fueling_types.ts</files>
  <action>
    Create types/fueling_types.ts with complete type definitions for fueling records:

    **Types to define:**
    1. `FuelingData` - Database model type (matches Prisma schema)
       - id: number
       - quantity: number
       - cost: number
       - cost_per_unit: number
       - date: string (ISO date string)
       - mileage: number
       - fuel_type: string (simplified from fuel_type_id)
       - full_tank: boolean
       - vehicle_id: number
       - created_at?: Date

    2. `FuelingFormValues` - Form state type
       - cost: string (for form input, user enters text)
       - quantity: string
       - cost_per_unit: number (calculated, 3 decimal places)
       - mileage: string
       - date: string (yyyy-MM-dd format for date input)
       - full_tank: boolean
       - fuel_type: string
       - vehicle_id: number
       - last_odometer?: number (for hint display, optional)

    3. `GroupedFuelings` - For monthly grouping
       - Record<string, FuelingData[]> (month key → fuelings array)

    4. `FuelTypeOption` - For fuel type select
       - id: number
       - name: string
       - value: string

    **Export all types** and create a `fuelTypeOptions` array matching the fuelTypes from vehicle_types.ts (reuse those values).

    Follow the patterns from vehicle_types.ts:
    - Use `type` keyword (not interface)
    - Export all types
    - Use PascalCase for type names
    - Use optional fields (?) for nullable/optional data

    **Important:** Store dates as strings (yyyy-MM-dd) for form compatibility, not Date objects. The API will handle conversion.

  </action>
  <verify>cat types/fueling_types.ts | head -60</verify>
  <done>types/fueling_types.ts exists with FuelingData, FuelingFormValues, GroupedFuelings, FuelTypeOption types exported, and fuelTypeOptions array defined</done>
</task>

</tasks>

<verification>
After completion:
1. Run `npm list react-intersection-observer date-fns` to verify installations
2. Check types/fueling_types.ts has all 4 type definitions exported
3. Verify no TypeScript errors in new file
</verification>

<success_criteria>

- react-intersection-observer and date-fns are installed and available in node_modules
- types/fueling_types.ts exists with complete type definitions matching Prisma schema and form requirements
- All types are exported and can be imported by subsequent plans
- File follows project conventions (types folder, snake_case filename, PascalCase type names)
  </success_criteria>

<output>
After completion, create `.planning/phases/03-fueling-records/03-01-SUMMARY.md`
</output>
