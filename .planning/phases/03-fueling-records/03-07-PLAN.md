---
phase: 03-fueling-records
plan: 07
type: execute
wave: 2
depends_on: [03-06-PLAN.md]
files_modified: []
autonomous: false
gap_closure: true

must_haves:
  truths:
    - 'User can add fueling in <30 seconds with smart defaults'
    - 'User sees price per liter auto-calculate in real-time'
    - 'User can mark tank as full or partial with visual distinction'
    - 'User sees toasts on add/edit/delete actions'
    - 'Form validation shows errors on invalid input'
  artifacts:
    - path: 'pages/vehicles/[id]/fuelings/new.tsx'
      provides: 'Create fueling page'
      min_lines: 93
    - path: 'pages/vehicles/[id]/fuelings/index.tsx'
      provides: 'Fueling list page'
      min_lines: 150
    - path: 'components/fueling/FuelingForm.tsx'
      provides: 'Form component with live calculation'
      min_lines: 448
    - path: 'components/fueling/FuelingList.tsx'
      provides: 'List component with badges'
      min_lines: 183
  key_links:
    - from: 'FuelingForm'
      to: 'POST /api/fueling'
      via: 'form submission'
      pattern: 'onSubmit.*formik'
    - from: 'FuelingListItem'
      to: 'list page'
      via: 'render'
      pattern: 'Full tank badge'
    - from: 'Toaster'
      to: 'hooks/*Fueling.ts'
      via: 'toaster.create()'
      pattern: "toaster\\.create"
---

<objective>
Complete human verification of Phase 3 fueling feature UX and usability.

Purpose: Verify that all 8 UX items from VERIFICATION.md and USER-TESTING.md work correctly from the user's perspective. Address any issues found during testing.

Output: All 8 checklist items verified as complete or documented issues if found.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-fueling-records/03-VERIFICATION.md
@.planning/phases/03-fueling-records/03-USER-TESTING.md
@.planning/phases/03-fueling-records/03-06-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Add Fueling Speed Test</name>
  <what-built>
    Complete add fueling workflow including form, API, and database persistence
  </what-built>
  <how-to-verify>
    **Test steps:**
    1. Start dev server: `npm run dev`
    2. Navigate to vehicles list, select a vehicle
    3. Click "Add Fueling" button
    4. Verify form opens with date showing today's date
    5. Verify odometer shows placeholder with last recorded value
    6. Verify fuel type dropdown shows vehicle's fuel type as default
    7. Enter quantity (e.g., 50) ‚Üí verify price per liter calculates
    8. Enter total cost (e.g., 100) ‚Üí verify price per liter recalculates
    9. Check/uncheck "Full tank" checkbox
    10. Click "Add Fueling" button
    11. Verify success toast appears at bottom-right: "Fueling added - Record saved successfully."
    12. Verify page redirects to fueling list
    13. Verify new record appears in list
    14. **Time measurement:** Note how many seconds from page load to success toast

    **Expected results:**
    - Date is today (YYYY-MM-DD format)
    - Odometer placeholder shows last recorded value
    - Fuel type matches vehicle type
    - Price per liter calculates: 100/50 = 2.000 PLN/L
    - Toast appears at bottom-right within 2 seconds
    - Redirect happens automatically
    - Total time: <30 seconds (expected ~17-20 seconds with smart defaults)

  </how-to-verify>
  <resume-signal>
    If all checks pass: "approved" or describe any issues found
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Smart Defaults with Draft Persistence</name>
  <what-built>
    Form with smart defaults (date, odometer, fuel type) and localStorage draft auto-save
  </what-built>
  <how-to-verify>
    **Test steps:**
    1. Add a fueling record as in Test 1
    2. Go back to vehicle details, click "Add Fueling" again
    3. Verify date is today (still defaults correctly)
    4. Verify odometer shows placeholder with LAST value (not the current vehicle's default)
    5. Verify fuel type matches the PREVIOUS fueling's fuel type
    6. Enter some values (don't submit)
    7. Refresh browser page (F5 or Cmd+R)
    8. Verify form restores your entered values from draft
    9. Try closing tab with unsaved form ‚Üí browser should show warning "Changes you made may not be saved"
    10. Submit form ‚Üí verify draft clears automatically

    **Expected results:**
    - Date defaults to today
    - Odometer shows previous fueling's mileage
    - Fuel type matches previous fueling
    - Form restores draft after refresh
    - Browser warning appears on tab close with unsaved draft
    - Draft clears on successful submission

  </how-to-verify>
  <resume-signal>
    If all checks pass: "approved" or describe any issues found
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Full vs Partial Tank Visual Distinction</name>
  <what-built>
    Fueling list with color-coded badges (green for full, orange for partial)
  </what-built>
  <how-to-verify>
    **Test steps:**
    1. Add a fueling with "Full tank" checked
    2. Go to fueling list, find new record
    3. Verify green badge shows (white badge with green text/border)
    4. Edit that record, uncheck "Full tank"
    5. Save changes
    6. Verify badge changes to orange with orange text, orange background, and orange border
    7. Verify badge shows text "Full tank" (when checked) or "Partial tank" (when unchecked)
    8. Add another fueling with full tank unchecked
    9. Verify list shows both badges with correct colors

    **Expected results:**
    - Full tank: Green badge with white background, no border color
    - Partial tank: Orange badge with orange.50 background, orange.300 border
    - Badge text matches checkbox state
    - Visual distinction is obvious at a glance

  </how-to-verify>
  <resume-signal>
    If all checks pass: "approved" or describe any issues found
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Infinite Scroll and Monthly Grouping</name>
  <what-built>
    Fueling list with infinite scroll pagination and monthly grouping
  </what-built>
  <how-to-verify>
    **Test steps:**
    1. Navigate to a vehicle with at least 10 fueling records
    2. Verify first 20 records load
    3. Scroll to bottom of list
    4. Verify "Load more" button or infinite scroll indicator appears
    5. Scroll down to trigger loading
    6. Verify next 20 records load without page reload (smooth, no jank)
    7. Verify records are grouped by month (e.g., "January 2026", "December 2025")
    8. Within each month, verify records are sorted newest first
    9. Verify empty state message when no fuelings exist (show "Add your first fueling" button)
    10. Click "Back to Vehicle" ‚Üí verify navigation works correctly

    **Expected results:**
    - 20 records load initially
    - Infinite scroll works smoothly without lag
    - Monthly grouping is clear with section headers
    - Records within month sorted newest first
    - Empty state is helpful and actionable

  </how-to-verify>
  <resume-signal>
    If all checks pass: "approved" or describe any issues found
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Edit Form and Live Price Calculation</name>
  <what-built>
    Edit page with pre-filled form and real-time price per liter calculation
  </what-built>
  <how-to-verify>
    **Test steps:**
    1. Navigate to a fueling record in the list
    2. Click edit icon (‚úèÔ∏è)
    3. Verify form pre-fills with correct values from the record
    4. Change quantity from 50 to 60
    5. Observe price per liter field ‚Üí verify it updates to 100/60 = 1.667 PLN/L
    6. Change total cost from 100 to 120
    7. Observe price per liter ‚Üí verify it recalculates to 120/60 = 2.000 PLN/L
    8. Change odometer to a higher value (e.g., 50000 instead of 45000)
    9. Save changes
    10. Verify success toast appears
    11. Verify redirect to fueling list
    12. Verify updated values appear correctly in list

    **Expected results:**
    - Form pre-fills all fields correctly
    - Price per liter updates live on every keystroke
    - Price per unit shows 3 decimal places (toFixed(3))
    - Odometer can be increased to update vehicle's last mileage
    - Toast confirms success
    - List updates to show new values

  </how-to-verify>
  <resume-signal>
    If all checks pass: "approved" or describe any issues found
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Delete Confirmation Flow</name>
  <what-built>
    Delete modal with confirmation dialog and safety warnings
  </what-built>
  <how-to-verify>
    **Test steps:**
    1. Navigate to a fueling record in the list
    2. Click delete icon (üóëÔ∏è)
    3. Verify modal opens with confirmation dialog
    4. Verify modal shows formatted date and cost amount
    5. Verify warning text: "This action cannot be undone. Vehicle statistics will be recalculated."
    6. Click "Cancel" button
    7. Verify modal closes without deleting record
    8. Navigate to that same record again
    9. Click delete icon again
    10. This time click "Delete" button in modal
    11. Verify success toast appears: "Fueling deleted - Record removed."
    12. Verify record is no longer in list
    13. Try adding a new fueling ‚Üí verify statistics recalculate correctly

    **Expected results:**
    - Modal shows correct record details (date, cost)
    - Warning text is clear and prominent (red)
    - Cancel button dismisses modal
    - Delete button actually removes record
    - Toast confirms deletion
    - Statistics reflect removal (once you have 2+ records)

  </how-to-verify>
  <resume-signal>
    If all checks pass: "approved" or describe any issues found
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Toast Notifications</name>
  <what-built>
    Toast notifications on all CRUD operations
  </what-built>
  <how-to-verify>
    **Test steps:**
    1. Open browser console (F12) or ensure you can see toasts clearly
    2. Add a new fueling ‚Üí verify green success toast appears: "Fueling added - Record saved successfully."
    3. Edit a fueling ‚Üí verify green success toast: "Fueling updated - Changes saved."
    4. Delete a fueling ‚Üí verify green success toast: "Fueling deleted - Record removed."
    5. Try invalid submission (empty cost) ‚Üí verify red error toast appears
    6. Observe toast placement (should be bottom-right)
    7. Verify toasts disappear automatically after timeout
    8. Verify toasts don't block interaction (can still scroll page)
    9. Try submitting rapidly ‚Üí verify toasts stack correctly if multiple come quickly

    **Expected results:**
    - All operations show appropriate toasts (success for add/edit/delete, error for validation failures)
    - Toasts appear at bottom-right
    - Colors are clear (green for success, red for error)
    - Messages are readable
    - Automatic dismissal works
    - No blocking behavior

  </how-to-verify>
  <resume-signal>
    If all checks pass: "approved" or describe any issues found
  </resume-signal>
</task>

</tasks>

<verification>
After all checkpoints, review VERIFICATION.md and USER-TESTING.md checklists:
- Verify all 8 items from VERIFICATION.md human checklist are marked as passed
- Verify all 9 items from USER-TESTING.md checklist are marked as passed
- Document any issues found during testing
</verification>

<success_criteria>
All 8 human verification items completed successfully:

1. Add fueling in <30 seconds with smart defaults
2. Smart defaults work (date, odometer, fuel type)
3. Draft persistence works (localStorage)
4. Infinite scroll works smoothly
5. Delete confirmation flow works correctly
6. Edit form works with live price calculation
7. Full/partial tank badges show correct colors
8. Toast notifications appear for all operations

No critical or blocking issues found during testing.
</success_criteria>

<output>
After completion, create `.planning/phases/03-fueling-records/03-07-SUMMARY.md` documenting all test results and any issues found.
</output>
