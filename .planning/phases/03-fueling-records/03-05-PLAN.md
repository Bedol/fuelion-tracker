---
phase: 03-fueling-records
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - components/fueling/FuelingForm.tsx
  - components/fueling/FuelingDeleteModal.tsx
  - components/vehicles/DeleteVehicleModal.tsx
  - components/ui/toaster.tsx
  - components/ui/ErrorAlert.tsx
  - components/vehicles/VehicleForm.tsx
  - components/fueling/NewFuelingForm.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - 'Project builds without TypeScript errors'
    - 'Dialog components use correct Chakra v3 API (Dialog.Positioner removed)'
    - 'Form components use Field instead of deprecated FormControl/FormLabel'
    - 'Switch and Select components import correctly from Chakra v3'
    - 'Toaster component uses correct v3 API'
    - 'All buttons are clickable with proper cursor and functionality'
  artifacts:
    - path: 'components/fueling/FuelingDeleteModal.tsx'
      provides: 'Delete modal with correct Dialog structure'
      exports: ['default']
    - path: 'components/vehicles/DeleteVehicleModal.tsx'
      provides: 'Delete vehicle modal with correct Dialog structure'
      exports: ['default']
    - path: 'components/ui/toaster.tsx'
      provides: 'Toast component with correct v3 API'
      exports: ['toaster']
    - path: 'components/ui/ErrorAlert.tsx'
      provides: 'Error alert component'
      exports: ['default']
    - path: 'components/vehicles/VehicleForm.tsx'
      provides: 'Vehicle form using Field instead of FormControl'
      exports: ['default']
    - path: 'components/fueling/FuelingForm.tsx'
      provides: 'Fueling form with correct component APIs'
      exports: ['default']
  key_links:
    - from: 'Dialog.Positioner'
      to: 'Dialog.Content'
      via: 'Chakra v3 structure change'
      pattern: 'Dialog.Positioner removed in v3'
    - from: 'FormControl/FormLabel'
      to: 'Field component'
      via: 'Chakra v3 form API'
      pattern: 'Use Field instead of FormControl'
---

<objective>
Fix Chakra UI v3 API incompatibilities blocking Phase 3 from building and functioning.

Purpose: The fueling records feature is complete but cannot be built/used due to TypeScript errors from using deprecated Chakra UI v2 APIs. This plan updates all components to use the correct Chakra UI v3 APIs.

Output: All components updated to Chakra v3 standards, project builds and runs successfully, buttons are clickable.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
**Chakra UI v3 breaking changes:**

1. **Dialog API**: Dialog.Positioner removed. Use Dialog.Content directly inside Portal

   ```tsx
   // v2 (wrong)
   <Dialog.Root>
     <Portal>
       <Dialog.Positioner>
         <Dialog.Content>...</Dialog.Content>
       </Dialog.Positioner>
     </Portal>
   </Dialog.Root>

   // v3 (correct)
   <Dialog.Root>
     <Portal>
       <Dialog.Backdrop />
       <Dialog.Content>...</Dialog.Content>
     </Portal>
   </Dialog.Root>
   ```

2. **Form API**: FormControl/FormLabel deprecated, use Field instead

   ```tsx
   // v2 (wrong)
   <FormControl>
     <FormLabel>Name</FormLabel>
     <Input />
   </FormControl>

   // v3 (correct)
   <Field label="Name">
     <Input />
   </Field>
   ```

3. **Switch/Select**: Use namespace imports correctly or use direct component

   ```tsx
   // v3 correct
   import { Switch } from '@chakra-ui/react';
   <Switch />;

   // OR use from custom component
   import { Switch } from '../ui/switch';
   ```

4. **Toaster**: Toaster component no longer accepts children prop, use static render

   ```tsx
   // v3 correct - render once in _app or layout
   <Toaster />
   // Use toaster.create() in components
   ```

5. **Button props**: isLoading → loading, loadingText stays same

   ```tsx
   // v2 (wrong)
   <Button isLoading={loading} loadingText="Saving...">

   // v3 (correct)
   <Button loading={loading} loadingText="Saving...">
   ```

**Files needing fixes:**

- components/fueling/FuelingDeleteModal.tsx - Dialog.Positioner
- components/vehicles/DeleteVehicleModal.tsx - Dialog.Positioner
- components/vehicles/VehicleForm.tsx - FormControl/FormLabel, Select/Switch imports
- components/fueling/FuelingForm.tsx - FormControl/FormLabel if used
- components/ui/toaster.tsx - Toaster v3 API
- components/ui/ErrorAlert.tsx - Collapsible children issue
- components/fueling/NewFuelingForm.tsx - FormControl/FormLabel, Select/Switch, isLoading

**Build currently fails on:**

```
ERROR [55:6] Type '{ children: Element; }' has no properties in common with type 'IntrinsicAttributes & DialogPositionerProps & RefAttributes<HTMLDivElement>'.
ERROR [5:2] Module '@chakra-ui/react' has no exported member 'FormControl'.
ERROR [11:2] '"@chakra-ui/react" has no exported member named 'useToast'
```

</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Dialog components (FuelingDeleteModal, DeleteVehicleModal)</name>
  <files>components/fueling/FuelingDeleteModal.tsx, components/vehicles/DeleteVehicleModal.tsx</files>
  <action>
    Fix both delete modal components to use Chakra v3 Dialog structure:

    **For both files:**
    1. Remove Dialog.Positioner wrapper
    2. Place Dialog.Content directly inside Portal (after Dialog.Backdrop)
    3. Move Dialog.Footer and Dialog.CloseTrigger inside Dialog.Content
    4. Remove any Dialog.ActionTrigger wrappers (v3 handles button nesting directly)

    **Pattern (v3):**
    ```tsx
    <Dialog.Root open={isOpen} onOpenChange={(details) => !details.open && onClose()}>
      <Portal>
        <Dialog.Backdrop />
        <Dialog.Content>
          <Dialog.Header>
            <Dialog.Title>Title</Dialog.Title>
          </Dialog.Header>
          <Dialog.Body>
            Content...
          </Dialog.Body>
          <Dialog.Footer>
            <Button>Cancel</Button>
            <Button>Confirm</Button>
          </Dialog.Footer>
        </Dialog.Content>
      </Portal>
    </Dialog.Root>
    ```

    Files to update:
    - components/fueling/FuelingDeleteModal.tsx
    - components/vehicles/DeleteVehicleModal.tsx

  </action>
  <verify>grep -l "Dialog.Positioner" components/fueling/FuelingDeleteModal.tsx components/vehicles/DeleteVehicleModal.tsx</verify>
  <done>Both dialog components use correct v3 structure, Dialog.Positioner removed, no type errors on Dialog elements</done>
</task>

<task type="auto">
  <name>Task 2: Fix Form components (VehicleForm, FuelingForm, NewFuelingForm)</name>
  <files>components/vehicles/VehicleForm.tsx, components/fueling/FuelingForm.tsx, components/fueling/NewFuelingForm.tsx</files>
  <action>
    Update all form components to use Chakra v3 Field API instead of deprecated FormControl/FormLabel:

    **Changes needed:**
    1. Remove imports: `FormControl`, `FormLabel`, `useToast`
    2. Add imports: `Field` (if not present)
    3. Replace all FormControl blocks with Field components
    4. Change Button prop: `isLoading` → `loading`
    5. Fix Select component: use HTML select element or import Select correctly
    6. Fix Switch component: ensure import is from correct path

    **Pattern (v3):**
    ```tsx
    // Before (v2)
    <FormControl isInvalid={!!errors.name}>
      <FormLabel htmlFor="name">Name</FormLabel>
      <Input id="name" {...props} />
      {errors.name && <FormErrorMessage>{errors.name}</FormErrorMessage>}
    </FormControl>

    // After (v3)
    <Field label="Name" invalid={!!errors.name} errorText={errors.name}>
      <Input id="name" {...props} />
    </Field>
    ```

    **Select pattern (v3):**
    ```tsx
    // Use native HTML select with Chakra styling
    <Field label="Fuel Type">
      <select onChange={handleChange} className="chakra-input">
        <option>...</option>
      </select>
    </Field>
    // OR use custom Select component from @chakra-ui/react if available
    ```

    **Switch pattern (v3):**
    ```tsx
    import { Switch } from '@chakra-ui/react'
    <Switch onCheckedChange={handleChange} />
    // NOT: import { Switch } from '@chakra-ui/react/switch' (namespace import)
    ```

    Files to update:
    - components/vehicles/VehicleForm.tsx
    - components/fueling/FuelingForm.tsx
    - components/fueling/NewFuelingForm.tsx

  </action>
  <verify>grep -l "FormControl\|FormLabel\|useToast" components/vehicles/VehicleForm.tsx components/fueling/FuelingForm.tsx components/fueling/NewFuelingForm.tsx 2>/dev/null | wc -l</verify>
  <done>All form components updated to use Field instead of FormControl, no deprecated imports, Button props fixed (isLoading → loading)</done>
</task>

<task type="auto">
  <name>Task 3: Fix Toaster and ErrorAlert components</name>
  <files>components/ui/toaster.tsx, components/ui/ErrorAlert.tsx</files>
  <action>
    Fix the toaster and error alert components to use Chakra v3 APIs:

    **components/ui/toaster.tsx:**
    - Toaster component no longer accepts children in v3
    - Should be rendered once in _app.tsx or layout, not with children
    - Use toaster.create() function to show toasts (already being used correctly)
    - Remove any children wrapper pattern
    - Export toaster instance for use in components

    **components/ui/ErrorAlert.tsx:**
    - Fix Collapsible children issue (may need to use proper v3 pattern)
    - Ensure all child elements are properly typed

    **Pattern (v3):**
    ```tsx
    // Toaster should just render once
    export const toaster = new Toaster()

    // Or in _app.tsx:
    <Toaster />

    // In components, use:
    toaster.create({ type: 'success', title: '...' })
    ```

    Files to update:
    - components/ui/toaster.tsx
    - components/ui/ErrorAlert.tsx

  </action>
  <verify>grep "children" components/ui/toaster.tsx | head -3</verify>
  <done>Toaster component no longer has children prop issues, ErrorAlert uses correct Collapsible API, no TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 4: Verify build and test clickability</name>
  <files>N/A</files>
  <action>
    Run the build to verify all TypeScript errors are resolved:

    ```bash
    npm run build 2>&1 | head -50
    ```

    Expected: Build succeeds with "✓ Export complete" or similar

    If errors remain:
    - Note which files still have errors
    - Use grep to identify specific error patterns
    - Fix remaining issues following Chakra v3 patterns

    After build succeeds, verify:
    1. Dev server starts without errors: `npm run dev`
    2. Navigate to vehicle detail page
    3. Buttons should be clickable (no disabled cursor)
    4. No hydration errors in console

  </action>
  <verify>npm run build 2>&1 | grep -c "error"</verify>
  <done>npm run build completes successfully with 0 errors, dev server starts, buttons are clickable</done>
</task>

</tasks>

<verification>
After completion:
1. `npm run build` completes without errors
2. No TypeScript errors in components
3. Dev server starts: `npm run dev`
4. Browser console shows no hydration errors
5. Buttons have proper pointer cursor and are clickable
6. Fueling feature can be tested end-to-end
</verification>

<success_criteria>

- npm run build succeeds with 0 errors
- All Dialog components use v3 structure (no Dialog.Positioner)
- All Form components use Field instead of FormControl/FormLabel
- All Button components use loading prop (not isLoading)
- Toaster component uses correct v3 API
- Dev server starts without errors
- No hydration errors in browser console
- All buttons are clickable with proper cursor
- Phase 3 fueling feature is fully functional
  </success_criteria>

<output>
After completion, create `.planning/phases/03-fueling-records/03-05-SUMMARY.md`
</output>
