---
phase: 01-auth-app-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - contexts/LocaleContext.tsx
  - lib/i18n/dictionaries/pl.json
  - lib/i18n/dictionaries/en.json
  - pages/_app.tsx
autonomous: true

must_haves:
  truths:
    - 'User can toggle between Polish and English interface language'
    - 'Navigation text displays in selected language'
    - 'Language preference persists during session'
  artifacts:
    - path: 'contexts/LocaleContext.tsx'
      provides: 'Locale state management and translation function'
      exports: ['LocaleProvider', 'useLocale']
      min_lines: 40
    - path: 'lib/i18n/dictionaries/pl.json'
      provides: 'Polish translations dictionary'
      contains: 'nav'
    - path: 'lib/i18n/dictionaries/en.json'
      provides: 'English translations dictionary'
      contains: 'nav'
  key_links:
    - from: 'pages/_app.tsx'
      to: 'contexts/LocaleContext'
      via: 'LocaleProvider wraps app'
      pattern: '<LocaleProvider>'
    - from: 'contexts/LocaleContext.tsx'
      to: 'lib/i18n/dictionaries'
      via: 'dynamic import based on locale'
      pattern: 'import.*dictionaries.*json'
---

<objective>
Implement lightweight internationalization (i18n) system with Polish and English language support using React Context and JSON dictionaries.

Purpose: Enable bilingual interface from Phase 1 as specified in context decisions. This foundation allows all subsequent components (navigation, forms, messages) to use translated strings.

Output: Working i18n context with locale switching, translation hook, and initial dictionaries for navigation and common UI strings.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-auth-app-shell/01-CONTEXT.md
@.planning/phases/01-auth-app-shell/01-RESEARCH.md
@pages/_app.tsx
</context>

<tasks>

<task type="auto">
  <name>Create LocaleContext with translation support</name>
  <files>
    contexts/LocaleContext.tsx
  </files>
  <action>
Create React Context that provides locale state (pl | en), setLocale function, and t() translation function.

Implementation details:

- Use useState for locale state, default to 'pl' (Polish primary market)
- Use useState for dictionary state
- Use useEffect to dynamically import dictionary JSON when locale changes
- Translation function t(key: string) should support nested keys using dot notation (e.g., "nav.vehicles")
- Handle missing keys by returning the key itself (graceful degradation)
- Export LocaleProvider component and useLocale hook

Follow research pattern from 01-RESEARCH.md Pattern 5 (Context-Based i18n).
Use TypeScript with proper types: Locale = 'pl' | 'en'
</action>
<verify>
Run `npm run build` to check for TypeScript errors.
Grep for exports: `grep -E "(export const LocaleProvider|export const useLocale)" contexts/LocaleContext.tsx`
</verify>
<done>
LocaleContext.tsx exists with LocaleProvider component, useLocale hook, locale state management, and nested key translation function. No TypeScript errors.
</done>
</task>

<task type="auto">
  <name>Create Polish and English translation dictionaries</name>
  <files>
    lib/i18n/dictionaries/pl.json
    lib/i18n/dictionaries/en.json
  </files>
  <action>
Create JSON dictionary files with initial translations covering navigation and common UI strings.

Required keys (keep consistent structure between pl.json and en.json):

- nav.vehicles: "Pojazdy" (pl) / "Vehicles" (en)
- nav.statistics: "Statystyki" (pl) / "Statistics" (en)
- nav.signOut: "Wyloguj" (pl) / "Sign Out" (en)
- nav.signIn: "Zaloguj" (pl) / "Sign In" (en)
- auth.signInWithGoogle: "Zaloguj przez Google" (pl) / "Sign in with Google" (en)
- auth.welcome: "Witaj w Fuelion" (pl) / "Welcome to Fuelion" (en)
- errors.generic: "Wystąpił błąd" (pl) / "An error occurred" (en)
- errors.tryAgain: "Spróbuj ponownie" (pl) / "Please try again" (en)
- errors.showDetails: "Pokaż szczegóły" (pl) / "Show details" (en)
- errors.hideDetails: "Ukryj szczegóły" (pl) / "Hide details" (en)
- loading.pleaseWait: "Proszę czekać..." (pl) / "Please wait..." (en)

Use proper JSON format with nested objects for namespacing (nav, auth, errors, loading).
</action>
<verify>
Validate JSON syntax: `node -e "JSON.parse(require('fs').readFileSync('lib/i18n/dictionaries/pl.json', 'utf8'))" && node -e "JSON.parse(require('fs').readFileSync('lib/i18n/dictionaries/en.json', 'utf8'))"`
Check both files exist: `ls lib/i18n/dictionaries/pl.json lib/i18n/dictionaries/en.json`
</verify>
<done>
Both pl.json and en.json exist with consistent structure covering nav, auth, errors, and loading namespaces. JSON is valid.
</done>
</task>

<task type="auto">
  <name>Integrate LocaleProvider into app</name>
  <files>
    pages/_app.tsx
  </files>
  <action>
Wrap the app with LocaleProvider to provide i18n context throughout the application.

Add import: `import { LocaleProvider } from '../contexts/LocaleContext'`

Update the provider hierarchy in MyApp function to wrap LocaleProvider around existing providers:

- Keep existing order: SessionProvider -> ChakraProvider -> QueryClientProvider
- Add LocaleProvider inside ChakraProvider, wrapping Layout
- Final nesting: SessionProvider > ChakraProvider > QueryClientProvider > LocaleProvider > Layout > HydrationBoundary > Component

This ensures locale context is available in all components including Layout, Header, Sidebar.

Do NOT modify existing SessionProvider, ChakraProvider, QueryClientProvider, or ReactQueryDevtools setup.
</action>
<verify>
Check import exists: `grep "import.*LocaleProvider" pages/_app.tsx`
Check provider wrapping: `grep -A 5 "<LocaleProvider>" pages/_app.tsx`
Run dev server: `npm run dev` and verify it starts without errors
</verify>
<done>
LocaleProvider is imported and wraps the app. Dev server starts successfully. All components now have access to useLocale hook.
</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - should complete without errors
2. Check locale context structure: Read contexts/LocaleContext.tsx and verify LocaleProvider, useLocale, and t() function exist
3. Check dictionaries: Verify pl.json and en.json have consistent structure
4. Check integration: Verify _app.tsx wraps components with LocaleProvider
</verification>

<success_criteria>

1. LocaleContext exists with locale state, setLocale function, and translation hook
2. Polish and English dictionaries exist with navigation and common UI strings
3. LocaleProvider wraps the app in \_app.tsx
4. Build completes without TypeScript errors
5. Translation function supports nested key access (e.g., "nav.vehicles")
   </success_criteria>

<output>
After completion, create `.planning/phases/01-auth-app-shell/01-01-SUMMARY.md`
</output>
