---
phase: 01-auth-app-shell
plan: 04
type: execute
wave: 2
depends_on: ['01-01']
files_modified:
  - components/layout/Navigation.tsx
  - components/layout/AuthenticatedLayout.tsx
  - components/Layout.tsx
  - pages/_app.tsx
autonomous: true

must_haves:
  truths:
    - 'Desktop users see top navigation bar with logo, nav links, language toggle, and user menu'
    - 'Mobile users see bottom navigation bar with icon-based nav links'
    - 'Navigation highlights the current active section'
    - 'User can sign out from navigation user menu'
    - 'Navigation text displays in selected language'
  artifacts:
    - path: 'components/layout/Navigation.tsx'
      provides: 'Responsive navigation component'
      exports: ['default']
      min_lines: 80
      contains: 'useBreakpointValue'
    - path: 'components/layout/AuthenticatedLayout.tsx'
      provides: 'Layout wrapper with responsive navigation'
      exports: ['default']
      min_lines: 30
  key_links:
    - from: 'components/layout/Navigation.tsx'
      to: 'contexts/LocaleContext'
      via: 'useLocale for translations'
      pattern: 'useLocale'
    - from: 'components/layout/Navigation.tsx'
      to: 'next-auth/react'
      via: 'useSession for user data, signOut function'
      pattern: 'signOut'
    - from: 'components/layout/AuthenticatedLayout.tsx'
      to: 'components/layout/Navigation'
      via: 'Navigation component render'
      pattern: 'Navigation'
---

<objective>
Replace existing sidebar-based layout with responsive navigation following context decisions: desktop top bar, mobile bottom bar, with language toggle and user menu.

Purpose: Complete UIUX-01 requirement (clear navigation between sections). Establish navigation pattern that works on desktop and mobile, supports i18n, and provides access to all main sections (Vehicles, Statistics) with sign-out capability.

Output: New responsive Navigation component and AuthenticatedLayout that replaces existing Header+Sidebar pattern with modern top/bottom bar navigation.
</objective>

<execution_context>
@/home/bweber/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bweber/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-auth-app-shell/01-CONTEXT.md
@.planning/phases/01-auth-app-shell/01-RESEARCH.md
@.planning/phases/01-auth-app-shell/01-01-SUMMARY.md
@components/Layout.tsx
@components/Header.tsx
@components/Sidebar.tsx
@pages/_app.tsx
</context>

<tasks>

<task type="auto">
  <name>Create responsive Navigation component</name>
  <files>
    components/layout/Navigation.tsx
  </files>
  <action>
Create new Navigation component that adapts between desktop top bar and mobile bottom bar.

Implementation requirements:

**Desktop version (md breakpoint and up):**

- Box container: position="sticky", top="0", width="full", bg="white", shadow="sm", zIndex="sticky"
- Display: `display={{ base: 'none', md: 'block' }}`
- Flex layout inside: maxW="1200px", mx="auto", px="6", py="4", justify="space-between"
- Left side: Fuelion heading (size="md") + nav buttons
  - Button for "Pojazdy" (t('nav.vehicles')) with FaCar icon, href="/vehicles"
  - Button for "Statystyki" (t('nav.statistics')) with FaChartBar icon, href="/statistics"
  - Use NextLink as={NextLink} href="..."
  - Highlight active: variant={isActive('/vehicles') ? 'solid' : 'ghost'}
- Right side: Language toggle button + Avatar with Menu
  - Language button: onClick toggles between pl/en, shows current locale ('PL' or 'EN')
  - Avatar: `<Avatar name={session?.user?.name} src={session?.user?.image} size="sm" />`
  - Menu.Root > Menu.Trigger (Avatar) > Menu.Content > Menu.Item (Sign out)
  - Sign out calls: `signOut({ callbackUrl: '/auth/signin' })`

**Mobile version (below md breakpoint):**

- Box container: position="fixed", bottom="0", width="full", bg="white", shadow="md", zIndex="sticky"
- Display: `display={{ base: 'block', md: 'none' }}`
- Flex layout: justify="space-around", py="3"
- Icon-only buttons (no text):
  - Vehicles button: FaCar icon + small label below
  - Statistics button: FaChartBar icon + small label below
  - Both vertical layout: flexDirection="column", height="auto", py="2"
  - Label: Box with fontSize="xs", mt="1"

**Hooks:**

- `const { data: session } = useSession()`
- `const { locale, setLocale, t } = useLocale()`
- `const router = useRouter()`
- `const isActive = (path: string) => router.pathname === path`

**Icons:**

- Import: FaCar, FaChartBar from 'react-icons/fa'
- Use Chakra Icon component wrapper or direct in Button leftIcon prop

Follow research code example "Responsive Navigation Component" but adapt to context decisions (only Vehicles and Statistics in nav, no Fuelings top-level link).

Note: Chakra UI 3.x uses Menu.Root, Menu.Trigger, Menu.Content, Menu.Item (not Menu as parent like v2).
</action>
<verify>
Check file exists: `ls components/layout/Navigation.tsx`
Check responsive display: `grep "display.*base.*md" components/layout/Navigation.tsx`
Check i18n: `grep "useLocale" components/layout/Navigation.tsx`
Check breakpoint logic: `grep "useBreakpointValue\|base.*md" components/layout/Navigation.tsx`
Run build: `npm run build` to check for TypeScript errors
</verify>
<done>
Navigation.tsx exists with desktop top bar and mobile bottom bar variants. Uses responsive display props, integrates with useLocale and useSession, shows active nav state, includes language toggle and user menu with sign-out. Builds without errors.
</done>
</task>

<task type="auto">
  <name>Create AuthenticatedLayout wrapper</name>
  <files>
    components/layout/AuthenticatedLayout.tsx
  </files>
  <action>
Create new layout component that includes responsive navigation and content area.

Structure:

- Box wrapper: minH="100vh", bg="gray.50"
- Navigation component at top (renders sticky desktop bar or fixed mobile bottom bar)
- Content area:
  - Box with flex="1", p="6", pt for mobile bottom nav clearance
  - Use responsive padding: `pb={{ base: "20", md: "6" }}` (extra bottom padding on mobile for nav bar)
  - Inner container: maxW="1200px", mx="auto"
  - Render {children}

TypeScript:

- Props: `{ children: ReactNode }`
- Proper typing with React.FC

This replaces the Header+Sidebar pattern from existing Layout.tsx with the new responsive nav pattern.

Import Navigation: `import Navigation from './Navigation'`

Export as default: `export default AuthenticatedLayout`
</action>
<verify>
Check file exists: `ls components/layout/AuthenticatedLayout.tsx`
Check Navigation import: `grep "import Navigation" components/layout/AuthenticatedLayout.tsx`
Check responsive padding: `grep "pb.*base.*md" components/layout/AuthenticatedLayout.tsx`
Run build: `npm run build` to check TypeScript errors
</verify>
<done>
AuthenticatedLayout.tsx exists with Navigation component and responsive content padding. Provides proper clearance for mobile bottom navigation. Builds without errors.
</done>
</task>

<task type="auto">
  <name>Update Layout.tsx and _app.tsx to use new navigation</name>
  <files>
    components/Layout.tsx
    pages/_app.tsx
  </files>
  <action>
Transition from old Header+Sidebar layout to new responsive navigation.

**For Layout.tsx:**
Keep the file but update it to be a simple wrapper that checks authentication and uses AuthenticatedLayout:

- Import: `import { useSession } from 'next-auth/react'`
- Import: `import AuthenticatedLayout from './layout/AuthenticatedLayout'`
- If session exists: render `<AuthenticatedLayout>{children}</AuthenticatedLayout>`
- If no session (public pages like signin): render children directly without navigation
- Keep existing TypeScript types

This maintains backward compatibility - Layout wraps everything in \_app.tsx, but now delegates to AuthenticatedLayout for authenticated pages.

**For pages/\_app.tsx:**
No changes needed - Layout is already wrapping Component. The updated Layout.tsx will handle switching between authenticated and public layouts.

**Why this approach:**

- Minimal disruption to existing structure
- Layout.tsx acts as auth-aware router
- Sign-in page won't show navigation (no session)
- Protected pages will show new responsive navigation (has session)

Do NOT delete Header.tsx or Sidebar.tsx yet - keep for reference. Simply don't import them in the updated Layout.tsx.
</action>
<verify>
Check Layout.tsx imports AuthenticatedLayout: `grep "AuthenticatedLayout" components/Layout.tsx`
Check session check exists: `grep "useSession" components/Layout.tsx`
Run dev server: `npm run dev` and check it starts without errors
Visit signin page: Should not show navigation
Visit home (authenticated): Should show navigation
</verify>
<done>
Layout.tsx now checks session and uses AuthenticatedLayout for authenticated pages. Public pages (signin) render without navigation. \_app.tsx unchanged (no modifications needed). Old Header/Sidebar components remain but are not used. Navigation switches between desktop and mobile views correctly.
</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - should complete without errors
2. Start dev server: `npm run dev`
3. Desktop view: Navigation bar should appear at top with logo, Vehicles, Statistics links, language toggle, and user avatar
4. Mobile view (resize browser < 768px): Navigation should appear at bottom with icon-based links
5. Check active state: Current page should be highlighted in navigation
6. Check language toggle: Clicking PL/EN should switch interface language
7. Check sign-out: Avatar menu should show sign-out option
8. Check sign-in page: Should NOT show navigation bar
</verification>

<success_criteria>

1. Navigation component exists with responsive desktop/mobile variants
2. Desktop shows top bar with text labels, mobile shows bottom bar with icons
3. Navigation uses i18n translations from LocaleContext
4. Active page is highlighted in navigation
5. Language toggle switches between Polish and English
6. User menu with sign-out works from navigation
7. AuthenticatedLayout provides proper layout with responsive padding
8. Sign-in page (public) does not show navigation
9. Protected pages show navigation correctly
   </success_criteria>

<output>
After completion, create `.planning/phases/01-auth-app-shell/01-04-SUMMARY.md`
</output>
